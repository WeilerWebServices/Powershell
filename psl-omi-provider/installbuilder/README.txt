Packaging of PSRP
=================

Client vs. Server
-----------------
When PSRP is used on the client-side, to communicate with a remote PowerShell server via WSMan, PSRP (along with OMIâ€™s libmi.so) will be packaged with PowerShell.  No additional installation will be required.

When PSRP is used on the server-side, working with OMI server to process WSMan messages, PSRP is a separate installation, and is defined below:

Packaging Tool
--------------

Current OMI (Open Management Infrastructure) products use the [InstallBuilder](https://github.com/Microsoft/pal.git) tool to create installation packages. By describing the files and directories to be installed in a simple text file, this tool is then able to generate appropriate installer package (e.g. RPM or DPKG package) for the target platform.

What is PSRP
------------

For more information on PSRP, see the Github respository [PowerShell Remoting Protocol](https://github.com/PowerShell/psl-omi-provider). 

Package Requirements
--------------------

PSRP requires that both OMI and PowerShell be installed on the system.  OMI package must be installed prior to PSRP installation, but PowerShell is only a run-time requirement. OMI packages can be downloaded from [OMI Github](https://github.com/PowerShell/omi/releases); and PowerShell packages are located at [PowerShell Github Releases](https://github.com/PowerShell/PowerShell/releases).

Building PSRP Package
---------------------

1. Install [InstallBuilder](https://github.com/Microsoft/pal.git).  
2. Download [PSRP](https://github.com/PowerShell/psl-omi-provider.git).
3. Follow instructions in PSRP to build OMI and PSRP. You should now have $HOME/psl-omi-provider/src/libpsrpomiprov.so.
4. Goto where this README file is located ($HOME/psl-omi-provider/installbuilder), type "make". Package file should now be created in $HOME/psl-omi-provider/omi/Unix/output/release.

Package Details
===============

Package Variables
-----------------

+ SHORT_NAME: 'omi-psrp-server'
+ LONG_NAME: 'PowerShell Remoting Protocol'
+ SHORT_NAME_PREFIX: 'MSFT'
+ VENDOR: 'Microsoft Corporation'
+ GROUP: 'System Environment/Daemons'
+ LICENSE: 'MIT'
+ MAINTAINER: 'Microsoft Corporation'
+ PROVIDES: 'omi-psrp-server'
+ DESCRIPTION: 'PowerShell Remoting Protocol provider'
+ COPYRIGHT_FILE: 'Copyright (c) Microsoft Corporation'

New Files Created
-----------------

+ /opt/omi/lib/libpsrpomiprov.so - new file installed
+ /etc/opt/omi/conf/omiregister/interop/psrpomiprov.reg - generated by command "omireg -n interop /opt/omi/lib/libpsrpomiprov.so
+ /opt/microsoft/powershell/libpsrpomiprov.so - (new symbolic link that points to /opt/omi/lib/libpsrpomiprov.so)

Design Philosophy
-----------------

PSRP is an OMI provider.  To create an OMI provider, you follow instructions in OMI documentation to build a dynamically linked library (.so file on a Linux system).  The installer copies this library to where OMI libraries are located (/opt/omi/lib), registers this provider (using the /opt/omi/bin/omireg command), and then restarts the Omi server.

Since PowerShell needs access to this same library, a symbolic link (softlink) is created in the PowerShell directory (/opt/microsoft/powershell) that points to the same dynamically linked library.




